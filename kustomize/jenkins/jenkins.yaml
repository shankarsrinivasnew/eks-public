---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: jenkins
spec:
  releaseName: jenkins
  chart:
    repository: https://charts.jenkins.io
    name: jenkins
    version: 4.2.15
  values:
    serviceAccount:
      create: true
      name: jenkins-controller
      annotations:
        eks.amazonaws.com/role-arn: arn:aws:iam::{{ AWS_ACCOUNT }}:role/eks/jenkins-controller
    controller:
      image: docker.artifactory.mgmt.aws.uk.tsb/docker-remote/jenkins/jenkins
      tag: 2.361.4-lts-alpine
      nodeSelector:
        taints.eks.aws.uk.tsb/role: mgmt
      tolerations:
        - key: role
          operator: Equal
          value: mgmt
          effect: NoSchedule
      healthProbes: true
      probes:
        startupProbe:
          periodSeconds: 30
          timeoutSeconds: 60
        livenessProbe:
          periodSeconds: 30
          timeoutSeconds: 60
        readinessProbe:
          periodSeconds: 30
          timeoutSeconds: 60
      ingress:
        enabled: true
        apiVersion: "networking.k8s.io/v1"
        annotations:
          kubernetes.io/ingress.class: alb
          alb.ingress.kubernetes.io/scheme: internal
          alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS":443}]'
          alb.ingress.kubernetes.io/target-type: ip
          alb.ingress.kubernetes.io/inbound-cidrs: "{{ VPC_CIDR }},10.161.52.0/22,10.161.56.0/22,10.161.60.0/22,10.198.165.58/32,172.27.240.0/20,10.184.136.84/32,10.184.136.117/32,10.184.136.116/30,10.184.136.120/30,10.184.136.124/32"
          alb.ingress.kubernetes.io/tags: environment={{ AWS_ENVIRONMENT }},cmdb=JENKINS_AWS,owner=Himanshu Jha,project=JENKINS_AWS,description=Jenkins component for shared services platform which can be used for building images and deploying application code,managed_by=rackspace,terraform=false 
          external-dns.alpha.kubernetes.io/hostname: jenkins.{{ DNS_ZONE }}
        hostName: jenkins.{{ DNS_ZONE }}
      resources:
        limits:
          cpu: 1
      # Environment variables that get added to the init container (useful for e.g. http_proxy)
      initContainerEnv:
        - name: http_proxy
          value: http://eu-west-2.proxy.aws.uk.tsb:3128
        - name: https_proxy
          value: http://eu-west-2.proxy.aws.uk.tsb:3128
        - name: no_proxy
          value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        - name: JAVA_TOOL_OPTIONS
          value: >-
            -Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb
            -Dhttp.proxyPort=3128
            -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb
            -Dhttps.proxyPort=3128
            -Dhttp.nonProxyHosts="localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb"
      containerEnv:
        - name: http_proxy
          value: http://eu-west-2.proxy.aws.uk.tsb:3128
        - name: https_proxy
          value: http://eu-west-2.proxy.aws.uk.tsb:3128
        - name: no_proxy
          value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
      installPlugins:
        - kubernetes:3896.v19b_160fd9589
        - workflow-aggregator:596.v8c21c963d92d
        - git:5.0.0
        - configuration-as-code:1569.vb_72405b_80249
        - matrix-auth:3.1.6
        - role-strategy:587.v2872c41fa_e51
        - workflow-job:1284.v2fe8ed4573d4
        - pipeline-model-api:2.2121.vd87fb_6536d1e
        - pipeline-model-definition:2.2121.vd87fb_6536d1e
        - pipeline-model-extensions:2.2121.vd87fb_6536d1e
        - scm-api:631.v9143df5b_e4a_a
        - ansicolor:1.0.2
        - github:1.37.0
        - scm-filter-branch-pr:0.5.1
        - job-dsl:1.82
        - git-client:4.2.0
        - pipeline-groovy-lib:629.vb_5627b_ee2104
        - ws-cleanup:0.44
        - ghprb:1.42.2
        - pipeline-aws:1.43
        - authorize-project:1.5.1
        - aws-credentials:191.vcb_f183ce58b_9
        - aws-global-configuration:108.v47b_fd43dfec6
        - command-launcher:90.v669d7ccb_7c31
        - custom-tools-plugin:0.8
        - docker-plugin:1.3.0
        - envinject:2.901.v0038b_6471582
        - extra-tool-installers:1.2
        - git-parameter:0.9.18
        - github-branch-source:1701.v00cc8184df93
        - http_request:1.16
        - maven-plugin:3.21
        - audit-trail:333.vb_e1b_b_0f1238c
        - dashboard-view:2.472.v9ff2a_e6a_c529
        - jira:3.9
        - sonar:2.15
        - pipeline-utility-steps:2.15.1
        - pipeline-github:2.8-138.d766e30bb08b
        - slack:631.v40deea_40323b
        - artifactory:3.18.0
        - build-timeout:1.26
        - build-timestamp:1.0.3
        - pipeline-graph-analysis:202.va_d268e64deb_3
      initializeOnce: false
      overwritePlugins: false
      installLatestSpecifiedPlugins: true
      installLatestPlugins: true
      JCasC:
        securityRealm: |-
          local:
            allowsSignup: false
            users:
              - id: "${chart-admin-username}"
                name: "Jenkins Admin"
                password: "${chart-admin-password}"
        authorizationStrategy:
            roleBased:
              roles:
                global:
                  - name: "admin"
                    description: "Jenkins administrators"
                    permissions:
                      - "Overall/Administer"
                    assignments:
                      - "admin"
#         authorizationStrategy: |-
#           loggedInUsersCanDoAnything:
#             allowAnonymousRead: false
        configScripts:
          github: |-
            unclassified:
              gitHubPluginConfig:
                hookUrl: "https://jenkins.{{ DNS_ZONE }}/github-webhook/"
                configs:
                  - name: "GitHub"
                    credentialsId: "github"
                    manageHooks: true
          libraries: |-
            unclassified:
              globalLibraries:
                libraries:
                  - name: "rax-jenkins-shared-library"
                    defaultVersion: "v1.0"
                    retriever:
                      modernSCM:
                        scm:
                          github:
                            credentialsId: "github-job"
                            repoOwner: "TSB-Bank"
                            repository: "rax-jenkins-shared-library"
                            traits:
                              - gitHubBranchDiscovery:
                                  strategyId: 1
                              - gitHubPullRequestDiscovery:
                                  strategyId: 1
                              - gitHubForkDiscovery:
                                  strategyId: 1
                                  trust: "gitHubTrustPermissions"
          proxy: |-
            jenkins:
              proxy:
                name: "eu-west-2.proxy.aws.uk.tsb"
                port: 3128
                noProxyHost: "localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb"
          tools: |-
            tool:
              customTool:
                installations:
                  - name: "pip"
                    properties:
                      - installSource:
                          installers:
                            - command:
                                command: |-
                                  curl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py
                                  python get-pip.py
                                toolHome: "/home/jenkins/.local/bin"
                  - name: "ansible"
                    properties:
                      - installSource:
                          installers:
                            - command:
                                command: |-
                                  curl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py
                                  python get-pip.py
                                  /home/jenkins/.local/bin/pip install --user ansible
                                  /home/jenkins/.local/bin/pip install --user pywinrm
                                toolHome: "/home/jenkins/.local/bin"
                  - name: "aws"
                    properties:
                      - installSource:
                          installers:
                            - command:
                                command: |-
                                  curl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py
                                  python get-pip.py
                                  curl https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip -o awscli.zip
                                  unzip awscli.zip
                                  /home/jenkins/.local/bin/pip install botocore boto3
                                toolHome: "aws/dist"
                  - name: "packer"
                    properties:
                      - installSource:
                          installers:
                            - command:
                                command: |-
                                  curl https://releases.hashicorp.com/packer/1.6.0/packer_1.6.0_linux_amd64.zip -o packer.zip
                                  unzip packer.zip
                                toolHome: "."
                  - name: "terraform"
                    properties:
                      - installSource:
                          installers:
                            - command:
                                command: |-
                                  curl https://releases.hashicorp.com/terraform/0.12.29/terraform_0.12.29_linux_amd64.zip -o terraform.zip
                                  unzip terraform.zip
                                toolHome: "."
                  - name: "terraform-0.12.31"
                    properties:
                      - installSource:
                          installers:
                            - command:
                                command: |-
                                  curl https://releases.hashicorp.com/terraform/0.12.31/terraform_0.12.31_linux_amd64.zip -o terraform.zip
                                  unzip terraform.zip
                                toolHome: "."
                  - name: "terraformonetwofour"
                    properties:
                      - installSource:
                          installers:
                            - command:
                                command: |-
                                  curl https://releases.hashicorp.com/terraform/1.2.4/terraform_1.2.4_linux_amd64.zip -L -o terraform_1.2.4_linux_amd64.zip
                                  unzip terraform_1.2.4_linux_amd64.zip
                                toolHome: "."
                  - name: "terraform-0.13.0"
                    properties:
                      - installSource:
                          installers:
                            - command:
                                command: |-
                                  curl https://releases.hashicorp.com/terraform/0.13.0/terraform_0.13.0_linux_amd64.zip -L -o terraform_0.13.0_linux_amd64.zip
                                  unzip terraform_0.13.0_linux_amd64.zip
                                toolHome: "."
          ansicolor: |-
            unclassified:
              ansiColorBuildWrapper:
                globalColorMapName: "xterm"
      jenkinsUrl: https://jenkins.{{ DNS_ZONE }}
      jenkinsHome: /var/jenkins_home

      ###### Ref https://www.jenkins.io/doc/book/managing/system-properties/#hudson-slaves-slavecomputer-allowunsupportedremotingversions ######
      javaOpts: >
        -Dhudson.slaves.SlaveComputer.allowUnsupportedRemotingVersions=true
    agent:
      jenkinsUrl: http://jenkins.jenkins.svc.cluster.local:8080
      jenkinsTunnel: jenkins-agent.jenkins.svc.cluster.local:50000
      image: docker.artifactory.mgmt.aws.uk.tsb/docker-remote/jenkins/inbound-agent
      tag: 4.11.2-4
      nodeSelector:
        taints.eks.aws.uk.tsb/role: mgmt
      componentName: jenkins-agent
      resources:
        limits:
          memory: 4Gi
      envVars:
        - name: http_proxy
          value: http://eu-west-2.proxy.aws.uk.tsb:3128
        - name: https_proxy
          value: http://eu-west-2.proxy.aws.uk.tsb:3128
        - name: no_proxy
          value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
      yamlTemplate: |-
        apiVersion: v1
        kind: Pod
        spec:
          command:
          - sleep
          args:
          - 99s
          serviceAccountName: jenkins-agent
          securityContext:
            fsGroup: 1337
          tolerations:
            - key: role
              operator: Equal
              value: mgmt
              effect: NoSchedule
      podTemplates:
        cbinit: |
          - name: cbinit
            nodeUsageMode: NORMAL
            runAsUser: 0
            label: jenkins-tsb-cb-init
            namespace: cb
            serviceAccount: tsb-cb
            nodeSelector: taints.eks.aws.uk.tsb/role=mgmt
            volumes:
            - secretVolume:
                mountPath: /var/jenkins_truststore/truststore.jks
                secretName: jenkins-truststore
            - secretVolume:
                mountPath: /etc/docker/certs.d/docker.artifactory.mgmt.aws.uk.tsb
                secretName: ca.crt
            - hostPathVolume:
                hostPath: "/var/run/docker.sock"
                mountPath: "/var/run/docker.sock"
            hostNetwork: false
            yaml: |-
              apiVersion: v1
              kind: Pod
              metadata:
                namespace: cb
              spec:
                command:
                - sleep
                args:
                - 99s
                serviceAccountName: tsb-cb
                securityContext:
                  runAsUser: 0
                  fsGroup: 1337
                tolerations:
                  - key: role
                    operator: Equal
                    value: mgmt
                    effect: NoSchedule
            envVars:
            - envVar:
                key: http_proxy
                value: http://eu-west-2.proxy.aws.uk.tsb:3128
            - envVar:
                key: https_proxy
                value: http://eu-west-2.proxy.aws.uk.tsb:3128
            - envVar:
                key: no_proxy
                value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
            containers:
            - name: "jnlp"
              args: "^${computer.jnlpmac} ^${computer.name}"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              - envVar:
                  key: "AWS_PROFILE"
                  value: "pre"
              - envVar:
                  key: JAVA_OPTS
                  value: >
                    -Djavax.net.ssl.trustStore=/var/jenkins_truststore/truststore.jks
                    -Djavax.net.ssl.trustStorePassword=changeit
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave:4.11.2-4"
              workingDir: "/home/jenkins/agent"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
            - name: "dind"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/docker-remote/docker:stable-dind"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
        push-agent: |
          - name: push-agent
            label: push-agent
            namespace: cb
            serviceAccount: tsb-cb
            nodeSelector: taints.eks.aws.uk.tsb/role=mgmt
            imagePullSecrets:
              - name: "artifactory-credentials"
            hostNetwork: false
            yaml: |-
              apiVersion: v1
              kind: Pod
              metadata:
                namespace: cb
              spec:
                command:
                - sleep
                args:
                - 99s
                serviceAccountName: tsb-cb
                securityContext:
                  fsGroup: 1337
                tolerations:
                  - key: role
                    operator: Equal
                    value: mgmt
                    effect: NoSchedule
            envVars:
              - envVar:
                  key: http_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: https_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: no_proxy
                  value: localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
            containers:
            - name: "jnlp"
              args: "^${computer.jnlpmac} ^${computer.name}"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/ems-docker-local/jenkins-agent:0.2.7"
              workingDir: "/home/jenkins/agent"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
            - name: "kafka"
              args: "cat"
              command: "/bin/sh -c"
              image: "wurstmeister/kafka"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
            volumes:
            - secretVolume:
                mountPath: "/home/jenkins/cacert"
                secretName: "cacert-truststore"
            - hostPathVolume:
                hostPath: "/var/run/docker.sock"
                mountPath: "/var/run/docker.sock"
        jnlp-sco: |
          - name: jnlp-sco
            label: tsb-sco
            namespace: sco
            serviceAccount: tsb-sco
            nodeSelector: taints.eks.aws.uk.tsb/role=mgmt
            imagePullSecrets:
              - name: "artifactory-credentials"
            hostNetwork: false
            yaml: |-
              apiVersion: v1
              kind: Pod
              metadata:
                # namespace: sco
              spec:
                command:
                - sleep
                args:
                - 99s
                # serviceAccountName: tsb-sco
                securityContext:
                  runAsUser: 0
                  fsGroup: 1337
                tolerations:
                  - key: role
                    operator: Equal
                    value: mgmt
                    effect: NoSchedule
            envVars:
              - envVar:
                  key: http_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: https_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: no_proxy
                  value: localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
            containers:
            - name: "jnlp"
              args: "^${computer.jnlpmac} ^${computer.name}"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              # - envVar:
              #     key: "AWS_PROFILE"
              #     value: "pre"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave:4.11.2-4"
              workingDir: "/home/jenkins/agent"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
            - name: "gradle"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "GRADLE_OPTS"
                  value: -Djavax.net.ssl.trustStore=/home/jenkins/publiccacerts/jenkins.truststore.jks -Djavax.net.ssl.trustStorePassword=changeit -Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb" -Dhttps.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/gradle:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "maven"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "MAVEN_OPTS"
                  value: "-Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts=localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/maven:11-6c5cc13"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "dind"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/docker-remote/docker:stable-dind"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "python"
              args: "cat"
              command: "/bin/sh -c"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/python:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
            volumes:
            # - secretVolume:
            #     mountPath: "/home/jenkins/.aws"
            #     secretName: "aws-cb-config"
            # - secretVolume:
            #     mountPath: "/home/jenkins/.kube"
            #     secretName: "k8s-config"
            - secretVolume:
                mountPath: "/home/jenkins/publiccacerts"
                secretName: "jenkins-truststore"
            - secretVolume:
                mountPath: "/home/jenkins/cacert"
                secretName: "cacert-truststore"
            - emptyDirVolume:
                memory: true
                mountPath: "/home/jenkins/.aws/cli"
            - hostPathVolume:
                hostPath: "/var/run/docker.sock"
                mountPath: "/var/run/docker.sock"
        jnlp-ods: |
          - name: jnlp-ods
            label: tsb-ods
            namespace: ods
            serviceAccount: tsb-ods
            nodeSelector: taints.eks.aws.uk.tsb/role=mgmt
            imagePullSecrets:
              - name: "artifactory-credentials"
            hostNetwork: false
            yaml: |-
              apiVersion: v1
              kind: Pod
              metadata:
                # namespace: ods
              spec:
                command:
                - sleep
                args:
                - 99s
                # serviceAccountName: tsb-ods
                securityContext:
                  runAsUser: 0
                  fsGroup: 1337
                tolerations:
                  - key: role
                    operator: Equal
                    value: mgmt
                    effect: NoSchedule
            envVars:
              - envVar:
                  key: http_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: https_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: no_proxy
                  value: localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
            containers:
            - name: "jnlp"
              args: "^${computer.jnlpmac} ^${computer.name}"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              # - envVar:
              #     key: "AWS_PROFILE"
              #     value: "pre"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave:4.11.2-4"
              workingDir: "/home/jenkins/agent"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
            - name: "gradle"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "GRADLE_OPTS"
                  value: -Djavax.net.ssl.trustStore=/home/jenkins/publiccacerts/jenkins.truststore.jks -Djavax.net.ssl.trustStorePassword=changeit -Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb" -Dhttps.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "gradle:8.0-jdk17"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "maven"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "MAVEN_OPTS"
                  value: "-Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts=localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "maven:3.6.3-openjdk-17"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "dind"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/docker-remote/docker:stable-dind"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "alpine-zip"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/alpine-zip:latest"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent" 
            - name: "python"
              args: "cat"
              command: "/bin/sh -c"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/python:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
            volumes:
            # - secretVolume:
            #     mountPath: "/home/jenkins/.aws"
            #     secretName: "aws-cb-config"
            # - secretVolume:
            #     mountPath: "/home/jenkins/.kube"
            #     secretName: "k8s-config"
            - secretVolume:
                mountPath: "/home/jenkins/publiccacerts"
                secretName: "jenkins-truststore"
            - secretVolume:
                mountPath: "/home/jenkins/cacert"
                secretName: "cacert-truststore"
            - emptyDirVolume:
                memory: true
                mountPath: "/home/jenkins/.aws/cli"
            - hostPathVolume:
                hostPath: "/var/run/docker.sock"
                mountPath: "/var/run/docker.sock"
        jnlp-datalake: |
          - name: jnlp-datalake
            label: tsb-datalake
            namespace: datalake
            serviceAccount: tsb-datalake
            nodeSelector: taints.eks.aws.uk.tsb/role=mgmt
            imagePullSecrets:
              - name: "artifactory-credentials"
            hostNetwork: false
            yaml: |-
              apiVersion: v1
              kind: Pod
              metadata:
                # namespace: datalake
              spec:
                command:
                - sleep
                args:
                - 99s
                # serviceAccountName: tsb-datalake
                securityContext:
                  runAsUser: 0
                  fsGroup: 1337
                tolerations:
                  - key: role
                    operator: Equal
                    value: mgmt
                    effect: NoSchedule
            envVars:
              - envVar:
                  key: http_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: https_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: no_proxy
                  value: localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
            containers:
            - name: "jnlp"
              args: "^${computer.jnlpmac} ^${computer.name}"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              # - envVar:
              #     key: "AWS_PROFILE"
              #     value: "pre"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave:4.11.2-4"
              workingDir: "/home/jenkins/agent"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
            - name: "gradle"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "GRADLE_OPTS"
                  value: -Djavax.net.ssl.trustStore=/home/jenkins/publiccacerts/jenkins.truststore.jks -Djavax.net.ssl.trustStorePassword=changeit -Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb" -Dhttps.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/gradle:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "maven"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "MAVEN_OPTS"
                  value: "-Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts=localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/maven:11-6c5cc13"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "dind"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/docker-remote/docker:stable-dind"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "python"
              args: "cat"
              command: "/bin/sh -c"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/python:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
            volumes:
            # - secretVolume:
            #     mountPath: "/home/jenkins/.aws"
            #     secretName: "aws-cb-config"
            # - secretVolume:
            #     mountPath: "/home/jenkins/.kube"
            #     secretName: "k8s-config"
            - secretVolume:
                mountPath: "/home/jenkins/publiccacerts"
                secretName: "jenkins-truststore"
            - secretVolume:
                mountPath: "/home/jenkins/cacert"
                secretName: "cacert-truststore"
            - emptyDirVolume:
                memory: true
                mountPath: "/home/jenkins/.aws/cli"
            - hostPathVolume:
                hostPath: "/var/run/docker.sock"
                mountPath: "/var/run/docker.sock"
        jnlp-sca: |
          - name: jnlp-sca
            label: tsb-sca
            namespace: sca
            serviceAccount: tsb-sca
            nodeSelector: taints.eks.aws.uk.tsb/role=mgmt
            imagePullSecrets:
              - name: "artifactory-credentials"
            hostNetwork: false
            yaml: |-
              apiVersion: v1
              kind: Pod
              metadata:
                # namespace: sca
              spec:
                command:
                - sleep
                args:
                - 99s
                # serviceAccountName: tsb-sca
                securityContext:
                  runAsUser: 0
                  fsGroup: 1337
                tolerations:
                  - key: role
                    operator: Equal
                    value: mgmt
                    effect: NoSchedule
            envVars:
              - envVar:
                  key: http_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: https_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: no_proxy
                  value: localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
            containers:
            - name: "jnlp"
              args: "^${computer.jnlpmac} ^${computer.name}"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              # - envVar:
              #     key: "AWS_PROFILE"
              #     value: "pre"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave:4.11.2-4"
              workingDir: "/home/jenkins/agent"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
            - name: "gradle"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "GRADLE_OPTS"
                  value: -Djavax.net.ssl.trustStore=/home/jenkins/publiccacerts/jenkins.truststore.jks -Djavax.net.ssl.trustStorePassword=changeit -Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb" -Dhttps.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/gradle:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "maven"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "MAVEN_OPTS"
                  value: "-Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts=localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/maven:11-6c5cc13"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "dind"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/docker-remote/docker:stable-dind"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "python"
              args: "cat"
              command: "/bin/sh -c"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/python:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
            volumes:
            # - secretVolume:
            #     mountPath: "/home/jenkins/.aws"
            #     secretName: "aws-cb-config"
            # - secretVolume:
            #     mountPath: "/home/jenkins/.kube"
            #     secretName: "k8s-config"
            - secretVolume:
                mountPath: "/home/jenkins/publiccacerts"
                secretName: "jenkins-truststore"
            - secretVolume:
                mountPath: "/home/jenkins/cacert"
                secretName: "cacert-truststore"
            - emptyDirVolume:
                memory: true
                mountPath: "/home/jenkins/.aws/cli"
            - hostPathVolume:
                hostPath: "/var/run/docker.sock"
                mountPath: "/var/run/docker.sock"
        jnlp-cob: |
          - name: jnlp-cob
            label: tsb-cb
            namespace: cb
            serviceAccount: tsb-cb
            nodeSelector: taints.eks.aws.uk.tsb/role=mgmt
            imagePullSecrets:
              - name: "artifactory-credentials"
            hostNetwork: false
            yaml: |-
              apiVersion: v1
              kind: Pod
              metadata:
                # namespace: cb
              spec:
                command:
                - sleep
                args:
                - 99s
                # serviceAccountName: tsb-cb
                securityContext:
                  runAsUser: 0
                  fsGroup: 1337
                tolerations:
                  - key: role
                    operator: Equal
                    value: mgmt
                    effect: NoSchedule
            envVars:
              - envVar:
                  key: http_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: https_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: no_proxy
                  value: localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
            containers:
            - name: "jnlp"
              args: "^${computer.jnlpmac} ^${computer.name}"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              # - envVar:
              #     key: "AWS_PROFILE"
              #     value: "pre"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave:4.11.2-4"
              workingDir: "/home/jenkins/agent"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
            - name: "gradle"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "GRADLE_OPTS"
                  value: -Djavax.net.ssl.trustStore=/home/jenkins/publiccacerts/jenkins.truststore.jks -Djavax.net.ssl.trustStorePassword=changeit -Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb" -Dhttps.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/gradle:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "gradle682"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "GRADLE_OPTS"
                  value: -Djavax.net.ssl.trustStore=/home/jenkins/publiccacerts/jenkins.truststore.jks -Djavax.net.ssl.trustStorePassword=changeit -Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb" -Dhttps.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cop-phase2/jenkinscicd/gradle:6.8-2"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "maven"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "MAVEN_OPTS"
                  value: "-Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts=localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/maven:11-6c5cc13"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "dind"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/docker-remote/docker:stable-dind"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "python"
              args: "cat"
              command: "/bin/sh -c"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/python:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
            volumes:
            # - secretVolume:
            #     mountPath: "/home/jenkins/.aws"
            #     secretName: "aws-cb-config"
            # - secretVolume:
            #     mountPath: "/home/jenkins/.kube"
            #     secretName: "k8s-config"
            - secretVolume:
                mountPath: "/home/jenkins/publiccacerts"
                secretName: "jenkins-truststore"
            - secretVolume:
                mountPath: "/home/jenkins/cacert"
                secretName: "cacert-truststore"
            - emptyDirVolume:
                memory: true
                mountPath: "/home/jenkins/.aws/cli"
            - hostPathVolume:
                hostPath: "/var/run/docker.sock"
                mountPath: "/var/run/docker.sock"
        jnlp-cop-phase2: |
          - name: jnlp-cop-phase2
            label: tsb-cop-phase2
            namespace: cop-phase2
            serviceAccount: tsb-cop-phase2
            nodeSelector: taints.eks.aws.uk.tsb/role=mgmt
            imagePullSecrets:
              - name: "artifactory-credentials"
            hostNetwork: false
            yaml: |-
              apiVersion: v1
              kind: Pod
              metadata:
                # namespace: cop-phase2
              spec:
                command:
                - sleep
                args:
                - 99s
                # serviceAccountName: tsb-cop-phase2
                securityContext:
                  runAsUser: 0
                  fsGroup: 1337
                tolerations:
                  - key: role
                    operator: Equal
                    value: mgmt
                    effect: NoSchedule
            envVars:
              - envVar:
                  key: http_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: https_proxy
                  value: http://eu-west-2.proxy.aws.uk.tsb:3128
              - envVar:
                  key: no_proxy
                  value: localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
            containers:
            - name: "jnlp"
              args: "^${computer.jnlpmac} ^${computer.name}"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave:4.11.2-4"
              workingDir: "/home/jenkins/agent"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
            - name: "gradle"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "GRADLE_OPTS"
                  value: -Djavax.net.ssl.trustStore=/home/jenkins/publiccacerts/jenkins.truststore.jks -Djavax.net.ssl.trustStorePassword=changeit -Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb" -Dhttps.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/gradle:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "gradle682"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "GRADLE_OPTS"
                  value: -Djavax.net.ssl.trustStore=/home/jenkins/publiccacerts/jenkins.truststore.jks -Djavax.net.ssl.trustStorePassword=changeit -Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb" -Dhttps.nonProxyHosts="localhost|127.0.0.1|172.20.0.1|169.254.169.254|10.0.0.0/8|172.20.0.0/16|.internal|.eu-west-2.elb.amazonaws.com|vault.service.consul|ssm.eu-west-2.amazonaws.com|ssmmessages.eu-west-2.amazonaws.com|ec2.eu-west-2.amazonaws.com|ec2messages.eu-west-2.amazonaws.com|s3.eu-west-2.amazonaws.com|autoscaling.eu-west-2.amazonaws.com|secretsmanager.eu-west-2.amazonaws.com|kms.eu-west-2.amazonaws.com|ecr.eu-west-2.amazonaws.com|.eks.amazonaws.com|.ecr.eu-west-2.amazonaws.com|.s3.eu-west-2.amazonaws.com|.cluster.local|*.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cop-phase2/jenkinscicd/gradle:6.8-2"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "maven"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "MAVEN_OPTS"
                  value: "-Dhttp.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttp.proxyPort=3128 -Dhttps.proxyHost=eu-west-2.proxy.aws.uk.tsb -Dhttps.proxyPort=3128 -Dhttp.nonProxyHosts=localhost,127.0.0.1,172.20.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb"
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/maven:11-6c5cc13"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "dind"
              args: "cat"
              command: "/bin/sh -c"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
              image: "docker.artifactory.mgmt.aws.uk.tsb/docker-remote/docker:stable-dind"
              livenessProbe:
                  failureThreshold: 0
                  initialDelaySeconds: 0
                  periodSeconds: 0
                  successThreshold: 0
                  timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
            - name: "python"
              args: "cat"
              command: "/bin/sh -c"
              image: "docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/python:11-6c5cc13"
              livenessProbe:
                failureThreshold: 0
                initialDelaySeconds: 0
                periodSeconds: 0
                successThreshold: 0
                timeoutSeconds: 0
              ttyEnabled: true
              workingDir: "/home/jenkins/agent"
              envVars:
              - envVar:
                  key: "JENKINS_URL"
                  value: "http://jenkins.jenkins.svc.cluster.local:8080"
            volumes:
            # - secretVolume:
            #     mountPath: "/home/jenkins/.aws"
            #     secretName: "aws-cb-config"
            # - secretVolume:
            #     mountPath: "/home/jenkins/.kube"
            #     secretName: "k8s-config"
            - secretVolume:
                mountPath: "/home/jenkins/publiccacerts"
                secretName: "jenkins-truststore"
            - secretVolume:
                mountPath: "/home/jenkins/cacert"
                secretName: "cacert-truststore"
            - emptyDirVolume:
                memory: true
                mountPath: "/home/jenkins/.aws/cli"
            - hostPathVolume:
                hostPath: "/var/run/docker.sock"
                mountPath: "/var/run/docker.sock"
    additionalAgents:
      terraform:
        podName: terraform
        componentName: jenkins-terraform
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          spec:
            serviceAccountName: jenkins-terraform
            securityContext:
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      packer:
        podName: packer
        componentName: jenkins-packer
        image: docker.artifactory.mgmt.aws.uk.tsb/rackspace/jenkins-inbound-agent-packer
        tag: 4.11-1
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          spec:
            serviceAccountName: "jenkins-packer"
            command:
            - sleep
            args:
            - 99s
            securityContext:
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      cb:
        podName: cb
        componentName: tsb-cb
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: cb
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-cb
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      ods:
        podName: ods
        componentName: tsb-ods
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: ods
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-ods
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      datalake:
        podName: datalake
        componentName: tsb-datalake
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: datalake
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-datalake
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      sca:
        podName: sca
        componentName: tsb-sca
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: sca
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-sca
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      sco:
        podName: sco
        componentName: tsb-sco
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: sco
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-sco
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      obs:
        podName: obs
        componentName: tsb-obs
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: obs
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-obs
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      ob:
        podName: api-gw-ob
        componentName: tsb-api-gw-ob
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: api-gw-ob
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-api-gw-ob
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      cop:
        podName: cop
        componentName: tsb-cop
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: cop
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-cop
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      cop-phase2:
        podName: cop-phase2
        componentName: tsb-cop-phase2
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: cop-phase2
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-cop-phase2
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      cob:
        podName: cob
        componentName: tsb-cob
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: cob
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-cob
            securityContext:
              #runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
      jnlp-root:
        podName: jnlp-root
        componentName: jnlp-root
        image: docker.artifactory.mgmt.aws.uk.tsb/cob/jenkins-cicd/jenkins-jnlp-slave
        tag: 4.11.2-4
        envVars:
          - name: http_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: https_proxy
            value: http://eu-west-2.proxy.aws.uk.tsb:3128
          - name: no_proxy
            value: localhost,127.0.0.1,169.254.169.254,10.0.0.0/8,172.20.0.0/16,.internal,.eu-west-2.elb.amazonaws.com,vault.service.consul,ssm.eu-west-2.amazonaws.com,ssmmessages.eu-west-2.amazonaws.com,ec2.eu-west-2.amazonaws.com,ec2messages.eu-west-2.amazonaws.com,s3.eu-west-2.amazonaws.com,autoscaling.eu-west-2.amazonaws.com,secretsmanager.eu-west-2.amazonaws.com,kms.eu-west-2.amazonaws.com,ecr.eu-west-2.amazonaws.com,.eks.amazonaws.com,.ecr.eu-west-2.amazonaws.com,.s3.eu-west-2.amazonaws.com,.cluster.local,.aws.uk.tsb
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: cb
          spec:
            command:
            - sleep
            args:
            - 99s
            serviceAccountName: tsb-cb
            securityContext:
              runAsUser: 0
              fsGroup: 1337
            tolerations:
              - key: role
                operator: Equal
                value: mgmt
                effect: NoSchedule
    persistence:
      enabled: true
      existingClaim: jenkins-home
